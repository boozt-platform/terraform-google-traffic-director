# SPDX-FileCopyrightText: Copyright Boozt Fashion, AB
# SPDX-License-Identifier: MIT
---
remotes:
  - git_url: https://github.com/boozt-platform/lefthook.git
    ref: v1.5.0
    configs:
      - hooks/commitlint/.lefthook.yaml
      - hooks/license-checker/.lefthook.yaml

pre-commit:
  parallel: true
  commands:
    terraform_fmt:
      glob: "*.tf"
      tags: [terraform]
      run: terraform fmt -check -recursive

    terraform_validate:
      glob: "*.tf"
      tags: [terraform]
      run: terraform init -backend=false && terraform validate

    terraform_docs:
      skip:
        - run: test ! -f ".terraform-docs.yml"
      stage_fixed: true
      tags: [terraform]
      run: task docs

    markdown-lint:
      glob: "*.md"
      tags: [lint]
      run: markdownlint --config .markdownlint.yaml {staged_files}

    yamllint:
      glob: "*.{yaml,yml}"
      tags: [lint]
      run: yamllint -c .yamllint.yaml {staged_files}

pre-push:
  commands:
    terraform_test:
      glob: "*.tf"
      tags: [terraform, test]
      run: task test
